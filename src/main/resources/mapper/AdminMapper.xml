<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.honeyboard.api.user.mapper.AdminMapper">
    <select id="selectUserByGeneration" resultType="UserInfo">
        SELECT id as user_id,
        email,
        name,
        generation_id,
        is_ssafy as ssafy
        FROM user
        WHERE role = 'USER'
        <if test="generationId != null">
            AND generation_id = #{generationId}
        </if>
        ORDER BY name
    </select>

    <select id="selectUserById" resultType="UserInfo">
        SELECT id       as user_id,
               name,
               email,
               generation_id,
               is_ssafy as ssafy
        FROM user
        WHERE id = #{userId}
    </select>

    <update id="updateUserInfo" parameterType="UserInfo">
        UPDATE user
        SET name          = #{name},
            email         = #{email},
            is_ssafy      = #{ssafy},
            generation_id = #{generationId}
        WHERE id = #{userId}
    </update>

    <insert id="insertGeneration" parameterType="Generation">
        INSERT INTO generation(name,
                               is_active)
        VALUES (#{name},
                #{active})
    </insert>

    <update id="updateGenerationIsActive" parameterType="int">
        UPDATE generation
        SET is_active = CASE
                            WHEN id = #{generationId} THEN TRUE
                            ELSE FALSE
            END
        WHERE id = #{generationId} OR is_active = TRUE
    </update>

    <delete id="deleteGenerationById" parameterType="int">
        DELETE
        FROM generation
        WHERE id = #{generationId}
    </delete>
</mapper>