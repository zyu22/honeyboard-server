<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.honeyboard.api.user.model.mapper.UserMapper">

    <!-- 사용자 등록 -->
    <insert id="insertUser" parameterType="User" useGeneratedKeys="true" keyProperty="userId">
        INSERT INTO user (
            email,
            password,
            name,
            generation_id,
            role,
            login_type,
            is_ssafy,
            created_at
        ) VALUES (
            #{email},
            #{password},
            #{name},
            #{generationId},
            #{role},
            #{loginType},
            #{isSsafy},
            NOW()
        )
    </insert>

    <!-- ID로 사용자 조회 -->
    <select id="selectUserById" parameterType="int" resultType="User">
        SELECT 
            id AS userId,
            email,
            password,
            name,
            generation_id AS generationId,
            role,
            login_type AS loginType,
            is_ssafy AS isSsafy,
            created_at AS createdAt
        FROM user
        WHERE id = #{userId}
    </select>

    <!-- 이메일로 사용자 조회 -->
    <select id="selectUserByEmail" parameterType="String" resultType="User">
        SELECT 
            id AS userId,
            email,
            password,
            name,
            generation_id AS generationId,
            role,
            login_type AS loginType,
            is_ssafy AS isSsafy,
            created_at AS createdAt
        FROM user
        WHERE email = #{email}
    </select>

    <!-- 비밀번호 업데이트 -->
    <update id="updatePassword" parameterType="User">
        UPDATE user
        SET password = #{password}
        WHERE id = #{userId}
    </update>

    <!-- 사용자 정보 업데이트 -->
    <update id="updateUser" parameterType="User">
        UPDATE user
        SET
            name = #{name},
            generation_id = #{generationId},
            is_ssafy = #{isSsafy}
        WHERE id = #{userId}
    </update>

    <!-- 사용자 수료 상태 업데이트 -->
    <update id="updateUserCompletionStatus" parameterType="int">
        UPDATE user
        SET is_ssafy = false
        WHERE id = #{userId}
    </update>

    <!-- 이메일 존재 여부 확인 -->
    <select id="selectExistedEmail" parameterType="String" resultType="Integer">
        SELECT COUNT(*)
        FROM user
        WHERE email = #{email}
    </select>

</mapper>
