<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.honeyboard.api.web.recommend.mapper.WebRecommendMapper">
    <!-- 웹 학습사이트 전체/기수별 조회 -->
    <select id="selectAllWebRecommend" parameterType="int" resultType="WebRecommend">
        SELECT
            id AS recommendId,
            title,
            url,
            content,
            user_id AS userId,
            generation_id AS generationId,
            created_at AS createdAt,
            updated_at AS updatedAt,
            is_deleted AS isDeleted
        FROM web_recommend
        WHERE generation_id = #{generationId}
        AND is_deleted = false
        ORDER BY created_at DESC
        LIMIT #{offset}, #{pageSize}
    </select>

    <!-- 웹 학습사이트 제목 기반 검색 -->
    <select id="searchWebRecommendByTitle" resultType="WebRecommend">
        SELECT
            id AS recommendId,
            title,
            url,
            content,
            user_id AS userId,
            generation_id AS generationId,
            created_at AS createdAt,
            updated_at AS updatedAt,
            is_deleted AS isDeleted
        FROM web_recommend
        WHERE generation_id = #{generationId}
        AND title LIKE CONCAT('%', #{title}, '%')
        AND is_deleted = false
    </select>

    <!-- 웹 학습사이트 상세 조회 -->
    <select id="selectWebRecommendById" parameterType="int" resultType="WebRecommend">
        SELECT
            id,
            title,
            url,
            content,
            user_id,
            generation_id,
            created_at,
            updated_at,
            is_deleted
        FROM web_recommend
        WHERE id = #{recommendId}
        AND is_deleted = false
    </select>

    <!-- 웹 학습사이트 작성 -->
    <insert id="insertWebRecommend" parameterType="WebRecommend">
        INSERT INTO web_recommend (
            title,
            url,
            content,
            user_id,
            generation_id,
            created_at,
            updated_at,
            is_deleted
        )
        VALUES (
            #{title},
            #{url},
            #{content},
            #{userId},
            #{generationId},
            NOW(),
            NOW(),
            false
        )
    </insert>

    <!-- 웹 학습사이트 수정 -->
    <update id="updateWebRecommend" parameterType="WebRecommend">
        UPDATE web_recommend
        SET
            title = #{title},
            content = #{content},
            url = #{url},
            updated_at = NOW()
        WHERE id = #{id}
        AND user_id = #{userId}
        AND is_deleted = false
    </update>

    <!-- 웹 학습사이트 삭제 -->
    <update id="deleteWebRecommend">
        UPDATE web_recommend
        SET
            is_deleted = true,
            updated_at = NOW()
        WHERE id = #{recommendId}
        AND is_deleted = false
    </update>

    <!-- 웹 학습사이트 전체 개수 조회 -->
    <select id="countWebRecommend" resultType="int">
        SELECT COUNT(*)
        FROM web_recommend
        WHERE generation_id = #{generationId}
        AND is_deleted = false
    </select>

    <!-- 웹 학습사이트 검색 개수 조회 -->
    <select id="countSearchWebRecommend" resultType="int">
        SELECT COUNT(*)
        FROM web_recommend
        WHERE generation_id = #{generationId}
        AND title LIKE CONCAT('%', #{title}, '%')
        AND is_deleted = false
    </select>
</mapper>